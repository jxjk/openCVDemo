# GUI功能模块使用指南

## 概述

本文档提供了新增的5个GUI功能模块的详细使用说明。所有模块均基于PyQt5开发，遵循项目代码规范。

---

## 1. 相机标定GUI (calibration_gui.py)

### 功能特性
- 完整的棋盘格相机标定流程
- 实时相机预览和图像采集
- 标定质量评估（重投影误差可视化）
- 标定结果保存和加载
- 标定报告导出

### 使用方法

#### 启动程序
```bash
python calibration_gui.py
```

#### 标定流程

1. **设置标定参数**
   - 棋盘格列数：默认9列
   - 棋盘格行数：默认6行
   - 方块大小：默认1.0mm

2. **采集标定图像**
   - 点击"连接相机"连接USB相机
   - 点击"开始预览"查看实时画面
   - 调整相机角度和位置，确保棋盘格清晰可见
   - 点击"采集图像"采集当前帧
   - 至少需要采集10张不同角度的图像
   - 也可以点击"添加图片文件"导入已有的标定图片

3. **执行标定**
   - 当采集足够的图像后，"开始标定"按钮将启用
   - 点击"开始标定"开始标定计算
   - 进度条显示标定进度

4. **查看结果**
   - 右侧面板显示标定结果：
     - 重投影误差（优秀 < 0.5像素，良好 < 1.0像素）
     - 相机内参矩阵
     - 畸变系数
   - 颜色编码：绿色（优秀）、橙色（良好）、红色（需重新标定）

5. **保存和导出**
   - 点击"保存标定结果"保存为JSON文件
   - 点击"导出标定报告"生成文本报告

### 注意事项
- 标定图像应覆盖整个视场
- 棋盘格应保持平整
- 避免光照不均匀和反光
- 重投影误差超过1.0像素时建议重新标定

---

## 2. 像素-毫米标定GUI (pixel_mm_calibration_gui.py)

### 功能特性
- 两种标定方法：参考长度标定、圆形标定
- 图像交互式选点
- 自动圆形检测
- 标定历史记录
- 标定结果应用到系统

### 使用方法

#### 启动程序
```bash
python pixel_mm_calibration_gui.py
```

#### 方法一：参考长度标定

1. 切换到"参考长度标定"选项卡
2. 设置参考长度（例如：标准件的实际长度）
3. 点击"加载图像"加载标定图像
4. 在图像上点击两个参考点（起点和终点）
5. 查看像素距离显示
6. 点击"开始标定"计算转换比例

#### 方法二：圆形标定

1. 切换到"圆形标定"选项卡
2. 设置圆形的实际直径
3. 设置最小和最大检测半径范围
4. 点击"加载图像"加载标定图像
5. 点击"自动检测圆形"自动识别圆形
6. 或者手动点击圆心位置
7. 点击"开始标定"计算转换比例

#### 应用标定结果

1. 标定完成后，转换比例会显示在顶部
2. 点击"保存标定结果"保存为JSON文件
3. 点击"应用到系统"将标定结果应用到检测系统
4. 标定历史会记录所有标定操作

### 注意事项
- 参考长度应使用已知精度的标准件
- 图像应清晰，避免模糊和畸变
- 自动圆形检测可能需要调整参数
- 建议使用IT7级或更高精度的标准件

---

## 3. 实时图像预览GUI (camera_preview_gui.py)

### 功能特性
- 实时相机预览（30fps）
- 曝光、增益参数实时调整
- 图像质量指标显示
- 辅助显示（十字线、网格、信息）
- 当前帧保存功能

### 使用方法

#### 启动程序
```bash
python camera_preview_gui.py
```

#### 基本操作

1. **连接相机**
   - 选择相机类型（默认USB）
   - 设置设备ID（默认0）
   - 点击"连接相机"

2. **开始预览**
   - 点击"开始预览"查看实时画面
   - 帧率会实时显示在预览窗口下方

3. **调整参数**
   - 曝光控制：拖动滑块调整曝光时间（关闭自动曝光后可用）
   - 增益控制：拖动滑块调整增益值

4. **辅助显示**
   - 显示十字线：在图像中心显示十字准线
   - 显示网格：显示100像素间距的网格
   - 显示信息：显示时间戳等信息

5. **采集图像**
   - 点击"采集图像"捕获当前帧
   - 点击"保存当前帧"保存为图片文件

#### 图像质量指标

- **亮度**：灰度均值（50-200为佳）
- **对比度**：灰度标准差（越高越好）
- **模糊度**：拉普拉斯方差（>300为清晰，<100为模糊）
- **噪声**：高频能量（适中为佳）

颜色指示：
- 绿色：指标良好
- 橙色：指标一般
- 红色：指标较差

### 注意事项
- 曝光和增益应根据实际光照调整
- 图像质量指标仅供参考，实际检测效果为准
- 保存图像建议使用PNG格式以保持质量

---

## 4. 检测结果可视化GUI (result_visualization_gui.py)

### 功能特性
- 检测结果图像标注
- 颜色编码（合格绿色、不合格红色）
- 尺寸和公差信息显示
- 结果表格统计
- 数据导出（CSV、Excel）

### 使用方法

#### 启动程序
```bash
python result_visualization_gui.py
```

#### 基本操作

1. **加载图像**
   - 点击"加载图像"选择检测结果图像
   - 图像会显示在左侧窗口

2. **添加检测结果**
   - 在右侧面板设置特征参数：
     - 特征名称：直径、长度、宽度等
     - 标称值：设计值
     - 实测值：测量值
     - 公差标准：IT5/IT7/IT8/IT9/IT11
   - 点击"添加结果"添加到表格和图像

3. **查看结果**
   - 左侧图像显示检测结果标注
   - 右侧表格显示详细数据
   - 顶部显示统计信息（总计、合格、不合格、合格率）

4. **显示选项**
   - 显示尺寸：在图像上标注测量值
   - 显示公差：在图像上标注公差范围
   - 颜色编码：合格显示绿色，不合格显示红色

5. **导出数据**
   - 点击"导出CSV"保存为CSV文件
   - 点击"导出Excel"保存为Excel文件
   - 点击"导出结果图像"保存带标注的图像

### 颜色编码说明
- **绿色**：检测结果合格（偏差在公差范围内）
- **红色**：检测结果不合格（偏差超出公差范围）

### 注意事项
- 需要安装pandas和openpyxl库才能导出Excel
- 图像标注位置为示例，实际应根据特征位置调整
- 合格率计算基于添加的所有结果

---

## 5. 配置管理GUI (config_editor_gui.py)

### 功能特性
- 可视化配置编辑
- 分标签页管理不同配置类型
- 公差表编辑（IT5/IT7/IT8/IT9/IT11）
- 配置预览和验证
- 配置导入/导出

### 使用方法

#### 启动程序
```bash
python config_editor_gui.py
```

#### 配置标签页

1. **检测参数**
   - 像素转换：像素到毫米转换比例、亚像素精度
   - 检测参数：最小圆度、轮廓面积范围
   - 边缘检测：Canny阈值、孔径大小
   - 圆检测：dp、参数1、参数2、半径范围
   - RANSAC：迭代次数、阈值

2. **公差表**
   - 选择公差标准（IT5/IT7/IT8/IT9/IT11）
   - 编辑各尺寸范围的公差值
   - 点击"应用更改"保存公差表

3. **路径配置**
   - 数据目录：检测结果存储路径
   - 模板目录：检测模板路径
   - 图像目录：图像文件路径
   - 标定文件：标定数据文件路径

4. **配置预览**
   - 以JSON格式显示当前配置
   - 用于验证配置正确性

#### 配置操作

1. **加载配置**
   - 点击"加载配置"加载config.json
   - 或点击"重新加载"刷新当前配置

2. **保存配置**
   - 点击"保存配置"保存到当前文件
   - 点击"另存为"保存到新文件

3. **重置配置**
   - 点击"重置为默认"恢复默认配置
   - 需要确认操作

### 配置验证
- 保存前检查配置格式
- 公差表数据范围验证
- 路径存在性检查（可选）

### 注意事项
- 修改配置后建议保存备份
- 公差表修改会影响所有使用该标准的检测
- 路径配置支持相对路径和绝对路径
- 配置文件使用UTF-8编码

---

## 依赖项

所有GUI模块需要以下依赖：

```bash
pip install PyQt5
pip install opencv-python
pip install numpy
```

可选依赖：
```bash
pip install pandas openpyxl  # 用于Excel导出
```

---

## 常见问题

### Q1: 相机无法连接？
A: 检查相机是否被其他程序占用，尝试更换设备ID。

### Q2: 标定失败？
A: 确保棋盘格清晰可见，采集至少10张不同角度的图像。

### Q3: 图像预览卡顿？
A: 降低图像分辨率或检查USB接口带宽。

### Q4: 配置保存失败？
A: 检查文件权限和磁盘空间，确保config.json可写。

### Q5: Excel导出失败？
A: 安装pandas和openpyxl库：`pip install pandas openpyxl`

---

## 技术支持

如遇到问题，请查看：
1. 日志文件：`logs/inspection_system_*.log`
2. 异常信息：`logs/inspection_system_errors_*.log`
3. 项目文档：`README.md`、`CODE_STYLE.md`

---

## 版本信息

- 创建日期：2026-02-10
- Python版本：3.8+
- PyQt5版本：5.15+
- OpenCV版本：4.5+

---

**文档结束**