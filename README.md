# 微小零件中高精度视觉检测系统

## 项目简介

本项目是基于OpenCV计算机视觉技术和亚像素级检测算法的自动化微小零件尺寸检测系统，用于检测直径20mm以下、长度40mm以下、精度等级为IT8级的微小零件。

**版本:** V1.0  
**创建日期:** 2026-02-10  
**精度目标:** IT8级（亚像素检测精度≥1/20像素）

## 功能特性

### 核心功能
- **图像采集**: 支持USB工业相机和大恒相机
- **相机标定**: 棋盘格标定和像素-毫米转换标定
- **亚像素检测**: 1/20像素精度的边缘检测和角点定位
- **尺寸测量**: 圆形零件直径测量、矩形零件长宽测量
- **公差判断**: IT8级公差标准自动判断
- **数据管理**: 检测结果记录、统计、导出

### 界面版本
- 图形用户界面（GUI）
- 实时图像预览
- 一键检测
- 数据统计显示
- 历史记录查询

## 系统要求

### 硬件要求
- **CPU**: Intel Core i5 或同等性能
- **内存**: 8GB以上
- **存储**: 100GB可用空间
- **相机**: 1000万像素以上工业相机（推荐）
- **镜头**: 定焦镜头或远心镜头
- **光源**: 环形LED光源
- **操作系统**: Windows 10/11 64位

### 软件要求
- **Python**: 3.8+
- **OpenCV**: 4.5+
- **NumPy**: 1.19+
- **Pandas**: 1.2+
- **Pillow**: 8.0+
- **openpyxl**: 3.0+
- **大恒相机SDK**: gxipy（可选）

## 安装步骤

### 1. 安装Python
下载并安装Python 3.8或更高版本：https://www.python.org/downloads/

### 2. 安装依赖库
```bash
pip install opencv-python numpy pandas pillow openpyxl
```

### 3. 安装大恒相机SDK（可选）
如果使用大恒相机，请安装大恒相机SDK和Python绑定：
```bash
pip install gxipy
```

### 4. 下载程序
将以下文件复制到工作目录：
- `inspection_system.py` - 命令行版本
- `inspection_system_gui.py` - GUI版本

## 使用说明

### 命令行版本

#### 启动程序
```bash
python inspection_system.py
```

#### 菜单功能
1. **标定像素-毫米转换系数**
   - 输入标定件的实际直径
   - 将标定件放入视野
   - 按回车键完成标定

2. **检测圆形零件**
   - 输入零件编号（可选）
   - 输入标称直径（可选）
   - 将零件放入视野
   - 按回车键完成检测

3. **检测矩形零件**
   - 输入零件编号（可选）
   - 输入标称宽度（可选）
   - 将零件放入视野
   - 按回车键完成检测

4. **查看统计数据**
   - 显示总检测数、合格数、不合格数、合格率

5. **导出数据到Excel**
   - 将检测结果导出为Excel文件

6. **退出**
   - 退出程序

### GUI版本

#### 启动程序
```bash
python inspection_system_gui.py
```

#### 主要功能区域

**1. 相机控制**
- 连接USB相机
- 连接大恒相机
- 断开相机
- 开始预览
- 停止预览

**2. 零件参数**
- 零件编号
- 零件类型（圆形/矩形）
- 标称尺寸（mm）
- 像素-毫米转换系数

**3. 检测控制**
- 单次检测
- 连续检测（可设置间隔时间）

**4. 检测结果**
- 测量直径
- 偏差
- 公差
- 合格/不合格判定

**5. 统计信息**
- 合格数
- 不合格数
- 合格率

**6. 菜单功能**
- 文件 → 导出数据到Excel
- 相机 → 连接/断开相机
- 标定 → 像素-毫米标定 / 相机内参标定
- 帮助 → 关于

## 标定流程

### 像素-毫米标定

1. 准备一个已知直径的标准件（如标准环规）
2. 将标准件放入相机视野
3. 执行标定程序
4. 系统自动计算像素-毫米转换系数

**注意**: 标定件应尽量充满视野，以提高标定精度

### 相机内参标定

1. 准备棋盘格标定板（推荐6×4内角点）
2. 采集10-20张不同角度的标定图像
3. 将图像保存到 `data/calib/` 目录
4. 执行相机标定程序
5. 系统自动计算相机内参和畸变系数

**注意**:
- 标定板应尽量充满视野
- 避免标定板倾斜过大
- 使用不同角度和位置的图像

## IT8级公差标准

| 公称尺寸段（mm） | IT8公差值（mm） |
|------------------|------------------|
| >1 - 3 | 0.014 |
| >3 - 6 | 0.018 |
| >6 - 10 | 0.022 |
| >10 - 18 | 0.027 |
| >18 - 30 | 0.033 |
| >30 - 40 | 0.039 |

## 目录结构

```
微小零件低精度视觉检测/
├── inspection_system.py          # 命令行版本
├── inspection_system_gui.py      # GUI版本
├── README.md                     # 使用文档
├── requirements.txt              # 依赖列表
├── data/                         # 数据目录
│   ├── calibration_data.json     # 相机标定数据
│   ├── config.json               # 系统配置
│   ├── inspection_results.csv    # 检测结果
│   ├── inspection_errors.csv     # 错误记录
│   ├── images/                   # 检测图像
│   └── calib/                    # 标定图像
├── 产品需求规格说明书.md
├── 产品进化接口设计方案.md
├── 图纸检测部位标定方案.md
├── 亚像素IT5级精度检测分析.md
└── AGENTS.md
```

## 数据文件说明

### 配置文件
- `data/config.json`: 系统配置，包含像素-毫米转换系数

### 标定文件
- `data/calibration_data.json`: 相机内参标定数据

### 结果文件
- `data/inspection_results.csv`: 所有检测结果记录
- `data/inspection_errors.csv`: 不合格品记录

### 图像文件
- `data/images/`: 检测图像自动保存目录

## 技术架构

### 核心模块
1. **配置管理** (`InspectionConfig`)
   - IT8级公差表
   - 图像处理参数
   - 相机参数

2. **图像采集** (`IImageAcquisition`)
   - USB相机驱动 (`USBCameraDriver`)
   - 大恒相机驱动 (`DahengCameraDriver`)

3. **相机标定** (`CameraCalibration`)
   - 棋盘格标定
   - 去畸变处理

4. **亚像素检测** (`SubpixelDetector`)
   - 亚像素边缘检测
   - 亚像素角点定位

5. **几何拟合** (`GeometryFitter`)
   - 最小二乘法圆拟合
   - RANSAC圆拟合
   - 矩形拟合

6. **检测引擎** (`InspectionEngine`)
   - 图像预处理
   - 圆形零件检测
   - 矩形零件检测
   - 结果绘制

7. **数据管理** (`DataManager`)
   - 结果保存
   - 图像保存
   - 数据导出
   - 统计分析

## 精度说明

### IT8级精度
- 比IT11级提升约4倍
- 适用于精密机械、电子制造等领域
- 亚像素检测精度：≥1/20像素

### 精度提升路径
- 当前：IT8级（1/20像素）
- 未来：IT7级（1/30像素）
- 远期：IT5级（1/50像素，需要更高硬件配置）

## 常见问题

### Q1: 相机连接失败怎么办？
A: 检查相机是否正确连接，尝试更换USB端口，确保相机驱动已安装。

### Q2: 检测精度不满足要求怎么办？
A: 
1. 重新进行像素-毫米标定
2. 使用更高分辨率的相机
3. 改善照明条件
4. 使用远心镜头

### Q3: 如何提高检测速度？
A:
1. 降低图像分辨率
2. 优化图像处理参数
3. 使用性能更好的计算机

### Q4: 支持哪些相机？
A: 
- USB工业相机（通用）
- 大恒相机（需要安装gxipy SDK）
- 支持OpenCV VideoCapture的相机

### Q5: 如何查看历史检测数据？
A: 
- 使用程序中的"查看统计数据"功能
- 直接打开 `data/inspection_results.csv` 文件
- 使用"导出数据到Excel"功能

## 技术支持

如有问题或建议，请联系项目负责人。

## 版本历史

### V1.0 (2026-02-10)
- 初始版本发布
- 实现IT8级精度检测
- 支持USB相机和大恒相机
- 提供命令行和GUI两种版本
- 实现亚像素检测算法
- 实现数据管理和导出功能

## 参考资料

- GB/T 1800.1-2009 产品几何技术规范（GPS）极限与配合
- ISO 2768-1:1989 一般公差 未注公差的线性和角度尺寸的公差
- OpenCV官方文档: https://docs.opencv.org/

## 许可证

本项目仅供学习和研究使用。

---

**开发者**: 基于参考程序和需求规格说明书整合开发  
**最后更新**: 2026-02-10